<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Demonstration · WidebandDoA.jl</title><meta name="title" content="Demonstration · WidebandDoA.jl"/><meta property="og:title" content="Demonstration · WidebandDoA.jl"/><meta property="twitter:title" content="Demonstration · WidebandDoA.jl"/><meta name="description" content="Documentation for WidebandDoA.jl."/><meta property="og:description" content="Documentation for WidebandDoA.jl."/><meta property="twitter:description" content="Documentation for WidebandDoA.jl."/><meta property="og:url" content="https://Red-Portal.github.io/WidebandDoA.jl/demonstration/"/><meta property="twitter:url" content="https://Red-Portal.github.io/WidebandDoA.jl/demonstration/"/><link rel="canonical" href="https://Red-Portal.github.io/WidebandDoA.jl/demonstration/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">WidebandDoA.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Demonstration</a><ul class="internal"><li><a class="tocitem" href="#System-Setup"><span>System Setup</span></a></li><li><a class="tocitem" href="#Creating-the-Bayesian-Model"><span>Creating the Bayesian Model</span></a></li><li><a class="tocitem" href="#Inference-with-RJMCMC"><span>Inference with RJMCMC</span></a></li><li><a class="tocitem" href="#Signal-Detection"><span>Signal Detection</span></a></li><li><a class="tocitem" href="#DoA-Estimation"><span>DoA Estimation</span></a></li><li><a class="tocitem" href="#Reconstruction"><span>Reconstruction</span></a></li></ul></li><li><a class="tocitem" href="../baseline/">Validation of Baseline</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Demonstration</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Demonstration</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Red-Portal/WidebandDoA.jl/blob/main/docs/src/demonstration.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Demonstration"><a class="docs-heading-anchor" href="#Demonstration">Demonstration</a><a id="Demonstration-1"></a><a class="docs-heading-anchor-permalink" href="#Demonstration" title="Permalink"></a></h1><h2 id="System-Setup"><a class="docs-heading-anchor" href="#System-Setup">System Setup</a><a id="System-Setup-1"></a><a class="docs-heading-anchor-permalink" href="#System-Setup" title="Permalink"></a></h2><p>We demonstrate the use of the package.</p><p>First, let&#39;s setup the array geometry. We will consider a system with a uniform linear array (ULA) with <code>M = 20</code> sensors and a spacing of 0.5 m, a sampling frequency of <code>fs = 3000</code>Hz, where the medium has a propagation speed of <code>c = 1500</code> m/s:</p><pre><code class="language-julia hljs">M  = 20
Δx = range(0, M*0.5; length=M)
c  = 1500.
fs = 3000.
nothing</code></pre><p>For the target sources, we will generate <code>k = 4</code> targets, with varying bandwidths and varying SNRs:</p><pre><code class="language-julia hljs">k       = 4
ϕ       = [ -60,  -15,  30,  45]/180*π # True direction-of-arrivals
f_begin = [  10,  100, 500, 800]       # Source signal starting frequencies
f_end   = [1000, 1500,1000, 900]       # Source signal ending frequencies
snr     = [  -6,   -4,   0,   4]       # Source signal SNRs in dB
nothing</code></pre><p>For simulating the signals, let&#39;s use a utility function we used for the experiments. The length of the simulated signal will be <code>N = 256</code>. This corresponds to using <code>S = 8</code> snapshots in the paper.</p><pre><code class="language-julia hljs">using Random, Random123

seed = (0x97dcb950eaebcfba, 0x741d36b68bef6415)
rng  = Random123.Philox4x(UInt64, seed, 8)
Random123.set_counter!(rng, 1)

N = 256

include(&quot;../../scripts/common.jl&quot;)
y, x  = simulate_signal(
    rng, N, N*8, ϕ, snr, f_begin, f_end, fs, 1.0, Δx, c; visualize=false
)
y</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">256×20 Matrix{Float64}:
  2.41246    3.69549    1.10596    …   1.84695     1.7737     0.418703
  2.68291   -1.05793   -7.08541        0.531793    3.4001     0.861055
 -3.68362   -3.31913    1.44163        0.249689   -0.650966  -1.60778
 -1.49198    2.55914    2.78228       -0.961038   -3.06066   -0.391159
  4.94762    2.82171   -1.14387        2.54853     0.925855   2.24827
  1.58997   -2.82069   -2.59786    …  -0.834786    0.699774   1.06278
 -1.01383   -2.14011    0.526192       1.57032    -0.20184   -0.533264
  0.354225   0.65065    1.60486        0.467703   -1.13893    0.313446
  1.32736    0.563337   0.29374       -0.644735    0.739011  -0.07014
 -1.19477    1.34038    2.52541        0.701587    0.578681   0.331686
  ⋮                                ⋱                         
  2.72908    0.957976  -0.0409031      0.253025    4.93277    3.39725
 -0.482836  -2.31516    1.28286        3.55875     0.439965  -1.54402
 -1.23038    0.264423   1.92087       -2.63607    -3.67887   -4.22279
 -0.13223    1.59716    0.509606   …  -6.03903    -2.19505    3.77205
 -0.519696   0.253321  -0.532106       1.2894      1.76821    1.04304
  0.898544   1.76963    1.56842        3.04477    -2.30516   -1.36028
  2.23895    0.62674   -2.0964        -4.84704    -4.01007   -1.77704
  1.55546   -1.37885   -2.77232        0.0178333   2.31962    1.71678
 -2.82873    0.283188   3.0903     …   4.12155     1.28721   -1.24501</code></pre><p>We can visualize the simulated signal through beamforming. Consider the Capon spectral estimator, more commonly known as minimum-variance distortionless response, or MVDR for short :</p><pre><code class="language-julia hljs">using Tullio
using Plots

include(&quot;../../scripts/baselines/common.jl&quot;)
include(&quot;../../scripts/baselines/subbandbeamform.jl&quot;)

N_fft  = 32
N_snap = N ÷ N_fft

R, _, f_range = snapshot_covariance(y, N_fft, fs, N_snap) # Short-time Fourier transform

config  = ArrayConfig(c, Δx)
n_grid  = 2^10
ϕ_range = range(-π/2, π/2; length=n_grid)
P       = subbandmvdr(R, ϕ_range, f_range, config)
Plots.heatmap(ϕ_range, f_range, 10*log10.(P&#39;), xlabel=&quot;DoA (ϕ)&quot;, ylabel=&quot;Frequency&quot;)
Plots.vline!(ϕ, label=&quot;True DoAs&quot;, linecolor=:red)
savefig(&quot;angle_frequency_spectrum_plot.svg&quot;)
nothing</code></pre><p>This yields the angle-frequency spectrum:  <img src="../angle_frequency_spectrum_plot.svg" alt/></p><p>We can see that the signals were correctly simulated as we specified.</p><h2 id="Creating-the-Bayesian-Model"><a class="docs-heading-anchor" href="#Creating-the-Bayesian-Model">Creating the Bayesian Model</a><a id="Creating-the-Bayesian-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-the-Bayesian-Model" title="Permalink"></a></h2><p>Now, let&#39;s construct the Bayesian model. We will use a non-informative inverse-gamma prior on the source SNRs (<span>$\gamma$</span> in the paper), a truncated negative-binomial prior on the model order (<span>$k$</span>), a Jeffrey&#39;s scale prior on the signal power (<span>$\sigma^2$</span>) as stated in the paper:</p><pre><code class="language-julia hljs">alpha, beta  = 0, 0
source_prior = InverseGamma(0.01, 0.01)
order_prior  = truncated(NegativeBinomial(1/2 + 0.1, 0.1/(0.1 + 1)), 0, M-1)
model        = WidebandDoA.WidebandIsoIsoModel(
    N, Δx, c, fs, source_prior, alpha, beta; order_prior
)
nothing</code></pre><p>The model can be conditioned on the data as follows:</p><pre><code class="language-julia hljs">cond  = WidebandConditioned(model, y)
nothing</code></pre><p>We are now ready to infer the posterior for this model.</p><h2 id="Inference-with-RJMCMC"><a class="docs-heading-anchor" href="#Inference-with-RJMCMC">Inference with RJMCMC</a><a id="Inference-with-RJMCMC-1"></a><a class="docs-heading-anchor-permalink" href="#Inference-with-RJMCMC" title="Permalink"></a></h2><p>For inference, we will use the <a href="https://github.com/Red-Portal/ReversibleJump.jl"><code>ReversibleJump</code></a> package, which is the inference counterpart of this package.</p><p>We use independent jump proposals with the uniform-log-normal auxiliary proposal distributions (<span>$q(\gamma)$</span>, <span>$q(\gamma)$</span> in the paper) as done in the paper:</p><pre><code class="language-julia hljs">using ReversibleJump

prop = UniformNormalLocalProposal(0.0, 2.0)
jump = IndepJumpProposal(prop)
nothing</code></pre><p>For the <em>update move</em>, we will use slice sampling<sup class="footnote-reference"><a id="citeref-N2003" href="#footnote-N2003">[N2003]</a></sup> with the stepping-out procedure:</p><pre><code class="language-julia hljs">mcmc = SliceSteppingOut([2.0, 2.0])
nothing</code></pre><p>The RJMCMC algorithm we use is the non-reversible jump algorithm by Gagnon and Doucet<sup class="footnote-reference"><a id="citeref-GD2020" href="#footnote-GD2020">[GD2020]</a></sup>.</p><pre><code class="language-julia hljs">rjmcmc = ReversibleJump.NonReversibleJumpMCMC(jump, mcmc; jump_rate=0.9)
nothing</code></pre><p>Now let&#39;s simulate some Markov chains!</p><pre><code class="language-julia hljs">n_samples = 4_000

initial_params = WidebandDoA.WidebandIsoIsoParam{Float64}[]
initial_order  = 0
samples, stats = ReversibleJump.sample(
    rng,
    rjmcmc,
    cond,
    n_samples,
    initial_order,
    initial_params;
    show_progress=false,
)
samples</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4000-element Vector{Vector{WidebandIsoIsoParam{Float64}}}:
 [WidebandIsoIsoParam{Float64}(0.8087467725851902, 1.511385091418317)]
 [WidebandIsoIsoParam{Float64}(0.8087467725851902, 1.511385091418317)]
 [WidebandIsoIsoParam{Float64}(0.8087467725851902, 1.511385091418317)]
 [WidebandIsoIsoParam{Float64}(0.8087467725851902, 1.511385091418317)]
 [WidebandIsoIsoParam{Float64}(0.8027468875356609, -2.84554483137798)]
 [WidebandIsoIsoParam{Float64}(0.8027468875356609, -2.84554483137798)]
 [WidebandIsoIsoParam{Float64}(0.8027468875356609, -2.84554483137798)]
 [WidebandIsoIsoParam{Float64}(0.8027468875356609, -2.84554483137798)]
 [WidebandIsoIsoParam{Float64}(0.8027468875356609, -2.84554483137798)]
 [WidebandIsoIsoParam{Float64}(0.8027468875356609, -2.84554483137798)]
 ⋮
 [WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811), WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426), WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676), WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)]
 [WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811), WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426), WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676), WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)]
 [WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811), WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426), WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676), WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)]
 [WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811), WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426), WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676), WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)]
 [WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811), WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426), WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676), WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)]
 [WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811), WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426), WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676), WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)]
 [WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811), WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426), WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676), WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)]
 [WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811), WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426), WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676), WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)]
 [WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811), WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426), WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676), WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)]</code></pre><h2 id="Signal-Detection"><a class="docs-heading-anchor" href="#Signal-Detection">Signal Detection</a><a id="Signal-Detection-1"></a><a class="docs-heading-anchor-permalink" href="#Signal-Detection" title="Permalink"></a></h2><p>Detection can be performed by analyzing the posterior of the model order (<span>$k$</span>).</p><p>Here is the trace of the model order:</p><pre><code class="language-julia hljs">Plots.plot([stat.order for stat in stats],  xlabel=&quot;RJMCMC Iteration&quot;,  ylabel=&quot;Model order&quot;)
savefig(&quot;model_order_trace.svg&quot;)
nothing</code></pre><p><img src="../model_order_trace.svg" alt/></p><p>And the histogram:</p><pre><code class="language-julia hljs">Plots.histogram([stat.order for stat in stats], xlabel=&quot;order&quot;, normed=true)
savefig(&quot;model_order_hist.svg&quot;)
nothing</code></pre><p><img src="../model_order_hist.svg" alt/></p><p>From the posterior, we can obtain point estimates of the model order <span>$k$</span>. In the paper, we use the median.</p><h2 id="DoA-Estimation"><a class="docs-heading-anchor" href="#DoA-Estimation">DoA Estimation</a><a id="DoA-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#DoA-Estimation" title="Permalink"></a></h2><p>Now, let&#39;s estimate the DoAs.</p><p>For this, we will discard the first 10% of the samples and only use the remaining samples.</p><pre><code class="language-julia hljs">burned = samples[n_samples ÷ 10:end]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3601-element Vector{Vector{WidebandIsoIsoParam{Float64}}}:
 [WidebandIsoIsoParam{Float64}(0.5227699302738016, -1.2924685642759912), WidebandIsoIsoParam{Float64}(-0.2628646716721509, -1.9231991996146085), WidebandIsoIsoParam{Float64}(-1.0271769689185417, -2.8861672557280453), WidebandIsoIsoParam{Float64}(0.781154452395531, -0.3083110078293083)]
 [WidebandIsoIsoParam{Float64}(0.5227699302738016, -1.2924685642759912), WidebandIsoIsoParam{Float64}(-0.2628646716721509, -1.9231991996146085), WidebandIsoIsoParam{Float64}(-1.0271769689185417, -2.8861672557280453), WidebandIsoIsoParam{Float64}(0.781154452395531, -0.3083110078293083)]
 [WidebandIsoIsoParam{Float64}(0.5227699302738016, -1.2924685642759912), WidebandIsoIsoParam{Float64}(-0.2628646716721509, -1.9231991996146085), WidebandIsoIsoParam{Float64}(-1.0271769689185417, -2.8861672557280453), WidebandIsoIsoParam{Float64}(0.781154452395531, -0.3083110078293083)]
 [WidebandIsoIsoParam{Float64}(0.5227699302738016, -1.2924685642759912), WidebandIsoIsoParam{Float64}(-0.2628646716721509, -1.9231991996146085), WidebandIsoIsoParam{Float64}(-1.0271769689185417, -2.8861672557280453), WidebandIsoIsoParam{Float64}(0.781154452395531, -0.3083110078293083)]
 [WidebandIsoIsoParam{Float64}(0.5227699302738016, -1.2924685642759912), WidebandIsoIsoParam{Float64}(-0.2628646716721509, -1.9231991996146085), WidebandIsoIsoParam{Float64}(-1.0271769689185417, -2.8861672557280453), WidebandIsoIsoParam{Float64}(0.781154452395531, -0.3083110078293083)]
 [WidebandIsoIsoParam{Float64}(0.5227699302738016, -1.2924685642759912), WidebandIsoIsoParam{Float64}(-0.2628646716721509, -1.9231991996146085), WidebandIsoIsoParam{Float64}(-1.0271769689185417, -2.8861672557280453), WidebandIsoIsoParam{Float64}(0.781154452395531, -0.3083110078293083)]
 [WidebandIsoIsoParam{Float64}(0.5227699302738016, -1.2924685642759912), WidebandIsoIsoParam{Float64}(-0.2628646716721509, -1.9231991996146085), WidebandIsoIsoParam{Float64}(-1.0271769689185417, -2.8861672557280453), WidebandIsoIsoParam{Float64}(0.781154452395531, -0.3083110078293083)]
 [WidebandIsoIsoParam{Float64}(0.5227699302738016, -1.2924685642759912), WidebandIsoIsoParam{Float64}(-0.2628646716721509, -1.9231991996146085), WidebandIsoIsoParam{Float64}(-1.0271769689185417, -2.8861672557280453), WidebandIsoIsoParam{Float64}(0.781154452395531, -0.3083110078293083)]
 [WidebandIsoIsoParam{Float64}(0.5227699302738016, -1.2924685642759912), WidebandIsoIsoParam{Float64}(-0.2628646716721509, -1.9231991996146085), WidebandIsoIsoParam{Float64}(-1.0271769689185417, -2.8861672557280453), WidebandIsoIsoParam{Float64}(0.781154452395531, -0.3083110078293083)]
 [WidebandIsoIsoParam{Float64}(0.5227699302738016, -1.2924685642759912), WidebandIsoIsoParam{Float64}(-0.2628646716721509, -1.9231991996146085), WidebandIsoIsoParam{Float64}(-1.0271769689185417, -2.8861672557280453), WidebandIsoIsoParam{Float64}(0.781154452395531, -0.3083110078293083)]
 ⋮
 [WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811), WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426), WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676), WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)]
 [WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811), WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426), WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676), WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)]
 [WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811), WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426), WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676), WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)]
 [WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811), WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426), WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676), WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)]
 [WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811), WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426), WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676), WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)]
 [WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811), WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426), WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676), WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)]
 [WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811), WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426), WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676), WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)]
 [WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811), WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426), WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676), WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)]
 [WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811), WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426), WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676), WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)]</code></pre><p><em>Bayesian model averaging</em> (BMA) correponds to flattening all the local variables:</p><pre><code class="language-julia hljs">flat = vcat(burned...)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">14404-element Vector{WidebandIsoIsoParam{Float64}}:
 WidebandIsoIsoParam{Float64}(0.5227699302738016, -1.2924685642759912)
 WidebandIsoIsoParam{Float64}(-0.2628646716721509, -1.9231991996146085)
 WidebandIsoIsoParam{Float64}(-1.0271769689185417, -2.8861672557280453)
 WidebandIsoIsoParam{Float64}(0.781154452395531, -0.3083110078293083)
 WidebandIsoIsoParam{Float64}(0.5227699302738016, -1.2924685642759912)
 WidebandIsoIsoParam{Float64}(-0.2628646716721509, -1.9231991996146085)
 WidebandIsoIsoParam{Float64}(-1.0271769689185417, -2.8861672557280453)
 WidebandIsoIsoParam{Float64}(0.781154452395531, -0.3083110078293083)
 WidebandIsoIsoParam{Float64}(0.5227699302738016, -1.2924685642759912)
 WidebandIsoIsoParam{Float64}(-0.2628646716721509, -1.9231991996146085)
 ⋮
 WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)
 WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811)
 WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426)
 WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676)
 WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)
 WidebandIsoIsoParam{Float64}(0.5290935912170005, -1.230642742679811)
 WidebandIsoIsoParam{Float64}(-0.2583726617047641, -1.831938937475426)
 WidebandIsoIsoParam{Float64}(-1.019947303122458, -2.674074001457676)
 WidebandIsoIsoParam{Float64}(0.7825588258415822, -0.06651109916689418)</code></pre><p>On the other hand, <em>Bayesian model selection</em> corresponds to selecting the samples that have a specific model order.</p><p>Here is the marginal posterior of the DoAs:</p><pre><code class="language-julia hljs">Plots.histogram([θ.phi for θ in flat], normed=true, bins=256, xlims=[-π/2, π/2], xlabel=&quot;DoA (ϕ)&quot;, label=&quot;Posterior&quot;, ylabel=&quot;Density&quot;)
Plots.vline!(ϕ, label=&quot;True&quot;, color=:red, linestyle=:dash)
savefig(&quot;doa_hist.svg&quot;)
nothing</code></pre><p><img src="../doa_hist.svg" alt/></p><p>Unfortunately, this does not yield the DoA posterior corresponding to each <em>source</em>. For this, we turn to the relabeling algorithm by Roodaki <em>et al.</em><sup class="footnote-reference"><a id="citeref-RBF2014" href="#footnote-RBF2014">[RBF2014]</a></sup>. This algorithm fits a Gaussian mixture model on the histogram above. It also generates labels for each local variable, so that we can label variable other than just the DoAs. For this though, we have to choose the number of mixture components.  Roodaki <em>et al.</em> recommend the 80% or 90% upper percentile of the posterior:</p><pre><code class="language-julia hljs">k_mixture = quantile([stat.order for stat in stats], 0.9) |&gt; Base.Fix1(round, Int)
ϕ_post    = [[target.phi for target in sample] for sample in burned]
mixture, labels = WidebandDoA.relabel(
    rng, ϕ_post, k_mixture; show_progress=false
)
mixture</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MixtureModel{Distributions.Normal{Float64}}(K = 4)
components[1] (prior = 0.2500): Distributions.Normal{Float64}(μ=-1.037916786731775, σ=0.011272917614835436)
components[2] (prior = 0.2500): Distributions.Normal{Float64}(μ=-0.2589917381372735, σ=0.0027930736757412395)
components[3] (prior = 0.2500): Distributions.Normal{Float64}(μ=0.5254654212761981, σ=0.003045342957594279)
components[4] (prior = 0.2500): Distributions.Normal{Float64}(μ=0.7829572135516365, σ=0.0013850208821611862)
</code></pre><p>Let&#39;s check that the Gaussian mixture approximation is accurate. This can be done by comparing the marginal density of the mixture against the histogram:</p><pre><code class="language-julia hljs">using StatsPlots

Plots.stephist([θ.phi for θ in flat], normed=true, bins=256, xlims=[-π/2, π/2], xlabel=&quot;DoA (ϕ)&quot;, ylabel=&quot;Density&quot;, label=&quot;Posterior&quot;, fill=true)
Plots.plot!(range(-π/2,π/2; length=1024), Base.Fix1(pdf, mixture), label=&quot;Mixture Approximation&quot;, linewidth=2)
savefig(&quot;doa_relabel_density.svg&quot;)
nothing</code></pre><p><img src="../doa_relabel_density.svg" alt/></p><p>The DoA posterior of each source is then represented by each component of the mixture:</p><pre><code class="language-julia hljs">Plots.plot(mixture, xlims=[-π/2, π/2], label=&quot;Component&quot;, fill=true)
Plots.vline!(ϕ, label=&quot;True&quot;, color=:red, linestyle=:dash)
savefig(&quot;doa_relabel_comp.svg&quot;)
nothing</code></pre><p><img src="../doa_relabel_comp.svg" alt/></p><h2 id="Reconstruction"><a class="docs-heading-anchor" href="#Reconstruction">Reconstruction</a><a id="Reconstruction-1"></a><a class="docs-heading-anchor-permalink" href="#Reconstruction" title="Permalink"></a></h2><p>Finally, we will demonstrate reconstruction. Unfortunately, the API for reconstruction is a little less ironed-out, but it is functional.</p><p>For this, we have to use the labels generated by the relabeling procedure. Here, for each RJMCMC sample, we will sample from the conditional posterior conditional and then relabel the signal segments to their corresponding source. We also thin the samples by a factor <code>n_thin = 100</code> to speed up things and reduce memory consumption.</p><pre><code class="language-julia hljs">x_samples = [Vector{Float64}[] for j in 1:k_mixture]
x_means   = [Vector{Float64}[] for j in 1:k_mixture]

n_thin = n_samples ÷ 10

samples_thinned = burned[1:n_thin:end]
labels_thinned  = labels[1:n_thin:end]

for (sample, labs) in zip(samples_thinned, labels_thinned)
    dist_x   = WidebandDoA.reconstruct(cond, sample)
    x_sample = rand(rng, dist_x) # Conditional posterior sample
    x_mean   = mean(dist_x)      # Conditional posterior mean

    kj        = length(sample)
    total_len = length(x_sample)
    blocksize = total_len ÷ kj

    # Labeling the conditional posterior mean and sample
    for (idx, label) in enumerate(labs)
        if label &gt; k_mixture
            # A label of k_mixture + 1 corresponds to clutter
            continue
        end

        # The source signals are flattened so we have to slice the block corresponding
        # to the source the label is pointing to.
        blockrange = (idx-1)*blocksize+1:idx*blocksize
        xj_sample  = x_sample[blockrange[1:N]]
        xj_mean    = x_mean[  blockrange[1:N]]
        push!(x_samples[label], xj_sample)
        push!(x_means[label],   xj_mean)
    end
end
nothing</code></pre><p>Now that sampling and relabeling is done, we can visualize the posterior samples against with the minimum mean-squared error (MMSE) estimates (posterior mean). The variability of the posterior samples represent the posterior uncertainty:</p><pre><code class="language-julia hljs">x_mmse = mean.(x_samples)

plts = map(1:k_mixture) do j
    p = Plots.plot(x_mmse[j], linecolor=:blue, label=&quot;MMSE&quot;, xlabel=&quot;Sample index&quot;)
    for x_sample in x_samples[j]
        Plots.plot!(p, x_sample, linecolor=:blue, alpha=0.5, linewidth=0.2, label=nothing)
    end
    p
end
Plots.plot(plts..., layout = (4, 1))
savefig(&quot;recon_samples.svg&quot;)
nothing</code></pre><p><img src="../recon_samples.svg" alt/></p><p>Finally, let&#39;s compare the MMSE against the ground truth <code>x</code>.</p><pre><code class="language-julia hljs">Plots.plot( x_mmse, layout=(4,1), label=&quot;MMSE&quot;, xlabel=&quot;Sample Index&quot;)
Plots.plot!(x,      layout=(4,1), label=&quot;True&quot;, xlabel=&quot;Sample Index&quot;)
savefig(&quot;recon_mmse_comparison.svg&quot;)
nothing</code></pre><p><img src="../recon_mmse_comparison.svg" alt/></p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-N2003"><a class="tag is-link" href="#citeref-N2003">N2003</a>Neal, Radford M. &quot;Slice sampling.&quot; The annals of statistics 31.3 (2003): 705-767.</li><li class="footnote" id="footnote-GD2020"><a class="tag is-link" href="#citeref-GD2020">GD2020</a>Gagnon, Philippe, and Arnaud Doucet. &quot;Nonreversible jump algorithms for Bayesian nested model selection.&quot; Journal of Computational and Graphical Statistics 30.2 (2020): 312-323.</li><li class="footnote" id="footnote-RBF2014"><a class="tag is-link" href="#citeref-RBF2014">RBF2014</a>Roodaki, Alireza, Julien Bect, and Gilles Fleury. &quot;Relabeling and summarizing posterior distributions in signal decomposition problems when the number of components is unknown.&quot; <em>IEEE Transactions on Signal Processing</em> (2014).</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../baseline/">Validation of Baseline »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 30 September 2024 05:53">Monday 30 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
